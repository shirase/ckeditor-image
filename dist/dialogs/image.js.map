{"version":3,"sources":["dialogs/image.js"],"names":["imageDialog","editor","dialogType","commitContent","args","arguments","inlineStyleField","this","getContentElement","commit","apply","foreach","widget","id","commitInternally","targetFields","incommit","dialog","getDialog","element","imageElement","IMAGE","concat","field","length","i","split","setup","previewPreloader","regexGetSize","onSizeChange","value","getValue","aMatch","match","switchLockRatio","lockRatio","oImageOriginal","originalElement","getCustomData","Math","round","$","width","height","isNaN","setValueOf","updatePreview","preview","userlockRatio","getValueOf","originalRatio","thisRatio","undefined","ratioButton","CKEDITOR","document","getById","btnLockSizesId","removeClass","addClass","setAttribute","env","hc","getChild","setHtml","ie","resetSize","emptyValues","widthValue","heightValue","widthField","heightField","setValue","setupDimension","type","checkDimension","size","defaultValue","dimension","getAttribute","getStyle","onImgLoadEvent","original","loader","imagePreviewLoaderId","setCustomData","removeListener","onImgLoadErrorEvent","setStyle","dontResetSize","config","image_prefillDimensions","firstLoad","tools","setTimeout","noimage","getUrl","plugins","get","path","numbering","getNextId","btnResetSizeId","previewLinkId","previewImageId","title","lang","image","minWidth","skinName","skin","minHeight","onShow","linkElement","imageEditMode","linkEditMode","addLink","getParentEditor","sel","getSelection","getSelectedElement","link","elementPath","contains","dom","createElement","linkChildren","getChildren","count","childTag","getItem","NODE_ELEMENT","is","setupContent","customImageElement","getName","data","cleanImageElement","clone","trim","removeAttribute","onOk","imgTagName","confirm","button2Img","insertElement","img2Button","setAttributes","alt","appendTo","selectElement","equals","append","onLoad","hidePage","doc","_","getDocument","addFocusable","onHide","remove","contents","label","infoTab","accessKey","elements","padding","children","widths","align","className","common","url","required","onChange","newUrl","removeStyle","on","src","setInitValue","isChanged","validate","notEmpty","urlMissing","html","btnUpload","style","buttons","fire","filebrowser","for","default","requiredContent","onKeyUp","call","isValid","parseInt","alert","invalidWidth","activeFilter","check","cssLength","invalidHeight","resetButton","evt","preventDefault","border","integer","validateBorder","borderStyle","items","notSet","alignLeft","alignRight","toLowerCase","hSpace","validateVSpace","marginLeftStyle","marginRightStyle","vSpace","marginTopStyle","marginBottomStyle","htmlEncode","image_previewText","linkTab","href","image_removeLinkByEmptyURL","action","target","filebrowserImageBrowseLinkUrl","hidden","browseServer","targetNew","targetTop","targetSelf","targetParent","advancedTab","langDir","langDirLtr","langDirRtl","langCode","longDescr","cssClass","advisoryTitle","cssStyle","inlineStyle","invalidInlineStyle","genStyle","cssText","aMatchH","aMatchW","attributesInStyle","add"],"mappings":"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","file":"image.js","sourcesContent":["/**\r\n * @license Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md or http://ckeditor.com/license\r\n */\r\n( function() {\r\n\tvar imageDialog = function( editor, dialogType ) {\r\n\t\t\t// Load image preview.\r\n\t\t\tvar IMAGE = 1,\r\n\t\t\t\tLINK = 2,\r\n\t\t\t\tPREVIEW = 4,\r\n\t\t\t\tCLEANUP = 8,\r\n\t\t\t\tregexGetSize = /^\\s*(\\d+)((px)|\\%)?\\s*$/i,\r\n\t\t\t\tregexGetSizeOrEmpty = /(^\\s*(\\d+)((px)|\\%)?\\s*$)|^$/i,\r\n\t\t\t\tpxLengthRegex = /^\\d+px$/;\r\n\r\n\t\t\tvar onSizeChange = function() {\r\n\t\t\t\t\tvar value = this.getValue(),\r\n\t\t\t\t\t\t// This = input element.\r\n\t\t\t\t\t\tdialog = this.getDialog(),\r\n\t\t\t\t\t\taMatch = value.match( regexGetSize ); // Check value\r\n\t\t\t\t\tif ( aMatch ) {\r\n\t\t\t\t\t\tif ( aMatch[ 2 ] == '%' ) // % is allowed - > unlock ratio.\r\n\t\t\t\t\t\tswitchLockRatio( dialog, false ); // Unlock.\r\n\t\t\t\t\t\tvalue = aMatch[ 1 ];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Only if ratio is locked\r\n\t\t\t\t\tif ( dialog.lockRatio ) {\r\n\t\t\t\t\t\tvar oImageOriginal = dialog.originalElement;\r\n\t\t\t\t\t\tif ( oImageOriginal.getCustomData( 'isReady' ) == 'true' ) {\r\n\t\t\t\t\t\t\tif ( this.id == 'txtHeight' ) {\r\n\t\t\t\t\t\t\t\tif ( value && value != '0' )\r\n\t\t\t\t\t\t\t\t\tvalue = Math.round( oImageOriginal.$.width * ( value / oImageOriginal.$.height ) );\r\n\t\t\t\t\t\t\t\tif ( !isNaN( value ) )\r\n\t\t\t\t\t\t\t\t\tdialog.setValueOf( 'info', 'txtWidth', value );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// this.id = txtWidth.\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tif ( value && value != '0' )\r\n\t\t\t\t\t\t\t\t\tvalue = Math.round( oImageOriginal.$.height * ( value / oImageOriginal.$.width ) );\r\n\t\t\t\t\t\t\t\tif ( !isNaN( value ) )\r\n\t\t\t\t\t\t\t\t\tdialog.setValueOf( 'info', 'txtHeight', value );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdatePreview( dialog );\r\n\t\t\t\t};\r\n\r\n\t\t\tvar updatePreview = function( dialog ) {\r\n\t\t\t\t\t//Don't load before onShow.\r\n\t\t\t\t\tif ( !dialog.originalElement || !dialog.preview )\r\n\t\t\t\t\t\treturn 1;\r\n\r\n\t\t\t\t\t// Read attributes and update imagePreview;\r\n\t\t\t\t\tdialog.commitContent( PREVIEW, dialog.preview );\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t};\r\n\r\n\t\t\t// Custom commit dialog logic, where we're intended to give inline style\r\n\t\t\t// field (txtdlgGenStyle) higher priority to avoid overwriting styles contribute\r\n\t\t\t// by other fields.\r\n\t\t\tfunction commitContent() {\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tvar inlineStyleField = this.getContentElement( 'advanced', 'txtdlgGenStyle' );\r\n\t\t\t\tinlineStyleField && inlineStyleField.commit.apply( inlineStyleField, args );\r\n\r\n\t\t\t\tthis.foreach( function( widget ) {\r\n\t\t\t\t\tif ( widget.commit && widget.id != 'txtdlgGenStyle' )\r\n\t\t\t\t\t\twidget.commit.apply( widget, args );\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\t// Avoid recursions.\r\n\t\t\tvar incommit;\r\n\r\n\t\t\t// Synchronous field values to other impacted fields is required, e.g. border\r\n\t\t\t// size change should alter inline-style text as well.\r\n\t\t\tfunction commitInternally( targetFields ) {\r\n\t\t\t\tif ( incommit )\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tincommit = 1;\r\n\r\n\t\t\t\tvar dialog = this.getDialog(),\r\n\t\t\t\t\telement = dialog.imageElement;\r\n\t\t\t\tif ( element ) {\r\n\t\t\t\t\t// Commit this field and broadcast to target fields.\r\n\t\t\t\t\tthis.commit( IMAGE, element );\r\n\r\n\t\t\t\t\ttargetFields = [].concat( targetFields );\r\n\t\t\t\t\tvar length = targetFields.length,\r\n\t\t\t\t\t\tfield;\r\n\t\t\t\t\tfor ( var i = 0; i < length; i++ ) {\r\n\t\t\t\t\t\tfield = dialog.getContentElement.apply( dialog, targetFields[ i ].split( ':' ) );\r\n\t\t\t\t\t\t// May cause recursion.\r\n\t\t\t\t\t\tfield && field.setup( IMAGE, element );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tincommit = 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar switchLockRatio = function( dialog, value ) {\r\n\t\t\t\t\tif ( !dialog.getContentElement( 'info', 'ratioLock' ) )\r\n\t\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t\tvar oImageOriginal = dialog.originalElement;\r\n\r\n\t\t\t\t\t// Dialog may already closed. (#5505)\r\n\t\t\t\t\tif ( !oImageOriginal )\r\n\t\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t\t// Check image ratio and original image ratio, but respecting user's preference.\r\n\t\t\t\t\tif ( value == 'check' ) {\r\n\t\t\t\t\t\tif ( !dialog.userlockRatio && oImageOriginal.getCustomData( 'isReady' ) == 'true' ) {\r\n\t\t\t\t\t\t\tvar width = dialog.getValueOf( 'info', 'txtWidth' ),\r\n\t\t\t\t\t\t\t\theight = dialog.getValueOf( 'info', 'txtHeight' ),\r\n\t\t\t\t\t\t\t\toriginalRatio = oImageOriginal.$.width * 1000 / oImageOriginal.$.height,\r\n\t\t\t\t\t\t\t\tthisRatio = width * 1000 / height;\r\n\t\t\t\t\t\t\tdialog.lockRatio = false; // Default: unlock ratio\r\n\r\n\t\t\t\t\t\t\tif ( !width && !height )\r\n\t\t\t\t\t\t\t\tdialog.lockRatio = true;\r\n\t\t\t\t\t\t\telse if ( !isNaN( originalRatio ) && !isNaN( thisRatio ) ) {\r\n\t\t\t\t\t\t\t\tif ( Math.round( originalRatio ) == Math.round( thisRatio ) )\r\n\t\t\t\t\t\t\t\t\tdialog.lockRatio = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if ( value !== undefined )\r\n\t\t\t\t\t\tdialog.lockRatio = value;\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tdialog.userlockRatio = 1;\r\n\t\t\t\t\t\tdialog.lockRatio = !dialog.lockRatio;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar ratioButton = CKEDITOR.document.getById( btnLockSizesId );\r\n\t\t\t\t\tif ( dialog.lockRatio )\r\n\t\t\t\t\t\tratioButton.removeClass( 'cke_btn_unlocked' );\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tratioButton.addClass( 'cke_btn_unlocked' );\r\n\r\n\t\t\t\t\tratioButton.setAttribute( 'aria-checked', dialog.lockRatio );\r\n\r\n\t\t\t\t\t// Ratio button hc presentation - WHITE SQUARE / BLACK SQUARE\r\n\t\t\t\t\tif ( CKEDITOR.env.hc ) {\r\n\t\t\t\t\t\tvar icon = ratioButton.getChild( 0 );\r\n\t\t\t\t\t\ticon.setHtml( dialog.lockRatio ? CKEDITOR.env.ie ? '\\u25A0' : '\\u25A3' : CKEDITOR.env.ie ? '\\u25A1' : '\\u25A2' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn dialog.lockRatio;\r\n\t\t\t\t};\r\n\r\n\t\t\tvar resetSize = function( dialog, emptyValues ) {\r\n\t\t\t\t\tvar oImageOriginal = dialog.originalElement,\r\n\t\t\t\t\t\tready = oImageOriginal.getCustomData( 'isReady' ) == 'true';\r\n\r\n\t\t\t\t\tif ( ready ) {\r\n\t\t\t\t\t\tvar widthField = dialog.getContentElement( 'info', 'txtWidth' ),\r\n\t\t\t\t\t\t\theightField = dialog.getContentElement( 'info', 'txtHeight' ),\r\n\t\t\t\t\t\t\twidthValue, heightValue;\r\n\r\n\t\t\t\t\t\tif ( emptyValues ) {\r\n\t\t\t\t\t\t\twidthValue = 0;\r\n\t\t\t\t\t\t\theightValue = 0;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\twidthValue = oImageOriginal.$.width;\r\n\t\t\t\t\t\t\theightValue = oImageOriginal.$.height;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\twidthField && widthField.setValue( widthValue );\r\n\t\t\t\t\t\theightField && heightField.setValue( heightValue );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdatePreview( dialog );\r\n\t\t\t\t};\r\n\r\n\t\t\tvar setupDimension = function( type, element ) {\r\n\t\t\t\t\tif ( type != IMAGE )\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tfunction checkDimension( size, defaultValue ) {\r\n\t\t\t\t\t\tvar aMatch = size.match( regexGetSize );\r\n\t\t\t\t\t\tif ( aMatch ) {\r\n\t\t\t\t\t\t\t// % is allowed.\r\n\t\t\t\t\t\t\tif ( aMatch[ 2 ] == '%' ) {\r\n\t\t\t\t\t\t\t\taMatch[ 1 ] += '%';\r\n\t\t\t\t\t\t\t\tswitchLockRatio( dialog, false ); // Unlock ratio\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn aMatch[ 1 ];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn defaultValue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar dialog = this.getDialog(),\r\n\t\t\t\t\t\tvalue = '',\r\n\t\t\t\t\t\tdimension = this.id == 'txtWidth' ? 'width' : 'height',\r\n\t\t\t\t\t\tsize = element.getAttribute( dimension );\r\n\r\n\t\t\t\t\tif ( size )\r\n\t\t\t\t\t\tvalue = checkDimension( size, value );\r\n\t\t\t\t\tvalue = checkDimension( element.getStyle( dimension ), value );\r\n\r\n\t\t\t\t\tthis.setValue( value );\r\n\t\t\t\t};\r\n\r\n\t\t\tvar previewPreloader;\r\n\r\n\t\t\tvar onImgLoadEvent = function() {\r\n\t\t\t\t\t// Image is ready.\r\n\t\t\t\t\tvar original = this.originalElement,\r\n\t\t\t\t\t\tloader = CKEDITOR.document.getById( imagePreviewLoaderId );\r\n\r\n\t\t\t\t\toriginal.setCustomData( 'isReady', 'true' );\r\n\t\t\t\t\toriginal.removeListener( 'load', onImgLoadEvent );\r\n\t\t\t\t\toriginal.removeListener( 'error', onImgLoadErrorEvent );\r\n\t\t\t\t\toriginal.removeListener( 'abort', onImgLoadErrorEvent );\r\n\r\n\t\t\t\t\t// Hide loader.\r\n\t\t\t\t\tif ( loader )\r\n\t\t\t\t\t\tloader.setStyle( 'display', 'none' );\r\n\r\n\t\t\t\t\t// New image -> new dimensions\r\n\t\t\t\t\tif ( !this.dontResetSize ) {\r\n\t\t\t\t\t\tresetSize( this, editor.config.image_prefillDimensions === false );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this.firstLoad ) {\r\n\t\t\t\t\t\tCKEDITOR.tools.setTimeout( function() {\r\n\t\t\t\t\t\t\tswitchLockRatio( this, 'check' );\r\n\t\t\t\t\t\t}, 0, this );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.firstLoad = false;\r\n\t\t\t\t\tthis.dontResetSize = false;\r\n\r\n\t\t\t\t\t// Possible fix for #12818.\r\n\t\t\t\t\tupdatePreview( this );\r\n\t\t\t\t};\r\n\r\n\t\t\tvar onImgLoadErrorEvent = function() {\r\n\t\t\t\t\t// Error. Image is not loaded.\r\n\t\t\t\t\tvar original = this.originalElement,\r\n\t\t\t\t\t\tloader = CKEDITOR.document.getById( imagePreviewLoaderId );\r\n\r\n\t\t\t\t\toriginal.removeListener( 'load', onImgLoadEvent );\r\n\t\t\t\t\toriginal.removeListener( 'error', onImgLoadErrorEvent );\r\n\t\t\t\t\toriginal.removeListener( 'abort', onImgLoadErrorEvent );\r\n\r\n\t\t\t\t\t// Set Error image.\r\n\t\t\t\t\tvar noimage = CKEDITOR.getUrl( CKEDITOR.plugins.get( 'image' ).path + 'images/noimage.png' );\r\n\r\n\t\t\t\t\tif ( this.preview )\r\n\t\t\t\t\t\tthis.preview.setAttribute( 'src', noimage );\r\n\r\n\t\t\t\t\t// Hide loader.\r\n\t\t\t\t\tif ( loader )\r\n\t\t\t\t\t\tloader.setStyle( 'display', 'none' );\r\n\r\n\t\t\t\t\tswitchLockRatio( this, false ); // Unlock.\r\n\t\t\t\t};\r\n\r\n\t\t\tvar numbering = function( id ) {\r\n\t\t\t\t\treturn CKEDITOR.tools.getNextId() + '_' + id;\r\n\t\t\t\t},\r\n\t\t\t\tbtnLockSizesId = numbering( 'btnLockSizes' ),\r\n\t\t\t\tbtnResetSizeId = numbering( 'btnResetSize' ),\r\n\t\t\t\timagePreviewLoaderId = numbering( 'ImagePreviewLoader' ),\r\n\t\t\t\tpreviewLinkId = numbering( 'previewLink' ),\r\n\t\t\t\tpreviewImageId = numbering( 'previewImage' );\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttitle: editor.lang.image[ dialogType == 'image' ? 'title' : 'titleButton' ],\r\n\t\t\t\tminWidth: ( CKEDITOR.skinName || editor.config.skin ) == 'moono-lisa' ? 500 : 420,\r\n\t\t\t\tminHeight: 360,\r\n\t\t\t\tonShow: function() {\r\n\t\t\t\t\tthis.imageElement = false;\r\n\t\t\t\t\tthis.linkElement = false;\r\n\r\n\t\t\t\t\t// Default: create a new element.\r\n\t\t\t\t\tthis.imageEditMode = false;\r\n\t\t\t\t\tthis.linkEditMode = false;\r\n\r\n\t\t\t\t\tthis.lockRatio = true;\r\n\t\t\t\t\tthis.userlockRatio = 0;\r\n\t\t\t\t\tthis.dontResetSize = false;\r\n\t\t\t\t\tthis.firstLoad = true;\r\n\t\t\t\t\tthis.addLink = false;\r\n\r\n\t\t\t\t\tvar editor = this.getParentEditor(),\r\n\t\t\t\t\t\tsel = editor.getSelection(),\r\n\t\t\t\t\t\telement = sel && sel.getSelectedElement(),\r\n\t\t\t\t\t\tlink = element && editor.elementPath( element ).contains( 'a', 1 ),\r\n\t\t\t\t\t\tloader = CKEDITOR.document.getById( imagePreviewLoaderId );\r\n\r\n\t\t\t\t\t// Hide loader.\r\n\t\t\t\t\tif ( loader )\r\n\t\t\t\t\t\tloader.setStyle( 'display', 'none' );\r\n\r\n\t\t\t\t\t// Create the preview before setup the dialog contents.\r\n\t\t\t\t\tpreviewPreloader = new CKEDITOR.dom.element( 'img', editor.document );\r\n\t\t\t\t\tthis.preview = CKEDITOR.document.getById( previewImageId );\r\n\r\n\t\t\t\t\t// Copy of the image\r\n\t\t\t\t\tthis.originalElement = editor.document.createElement( 'img' );\r\n\t\t\t\t\tthis.originalElement.setAttribute( 'alt', '' );\r\n\t\t\t\t\tthis.originalElement.setCustomData( 'isReady', 'false' );\r\n\r\n\t\t\t\t\tif ( link ) {\r\n\t\t\t\t\t\tthis.linkElement = link;\r\n\t\t\t\t\t\tthis.linkEditMode = true;\r\n\r\n\t\t\t\t\t\t// If there is an existing link, by default keep it (true).\r\n\t\t\t\t\t\t// It will be removed if certain conditions are met and Link tab is enabled. (#13351)\r\n\t\t\t\t\t\tthis.addLink = true;\r\n\r\n\t\t\t\t\t\t// Look for Image element.\r\n\t\t\t\t\t\tvar linkChildren = link.getChildren();\r\n\t\t\t\t\t\tif ( linkChildren.count() == 1 ) {\r\n\t\t\t\t\t\t\tvar childTag = linkChildren.getItem( 0 );\r\n\r\n\t\t\t\t\t\t\tif ( childTag.type == CKEDITOR.NODE_ELEMENT ) {\r\n\t\t\t\t\t\t\t\tif ( childTag.is( 'img' ) || childTag.is( 'input' ) ) {\r\n\t\t\t\t\t\t\t\t\tthis.imageElement = linkChildren.getItem( 0 );\r\n\t\t\t\t\t\t\t\t\tif ( this.imageElement.is( 'img' ) )\r\n\t\t\t\t\t\t\t\t\t\tthis.imageEditMode = 'img';\r\n\t\t\t\t\t\t\t\t\telse if ( this.imageElement.is( 'input' ) )\r\n\t\t\t\t\t\t\t\t\t\tthis.imageEditMode = 'input';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Fill out all fields.\r\n\t\t\t\t\t\tif ( dialogType == 'image' )\r\n\t\t\t\t\t\t\tthis.setupContent( LINK, link );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Edit given image element instead the one from selection.\r\n\t\t\t\t\tif ( this.customImageElement ) {\r\n\t\t\t\t\t\tthis.imageEditMode = 'img';\r\n\t\t\t\t\t\tthis.imageElement = this.customImageElement;\r\n\t\t\t\t\t\tdelete this.customImageElement;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ( element && element.getName() == 'img' && !element.data( 'cke-realelement' ) ||\r\n\t\t\t\t\t\telement && element.getName() == 'input' && element.getAttribute( 'type' ) == 'image' ) {\r\n\t\t\t\t\t\tthis.imageEditMode = element.getName();\r\n\t\t\t\t\t\tthis.imageElement = element;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this.imageEditMode ) {\r\n\t\t\t\t\t\t// Use the original element as a buffer from  since we don't want\r\n\t\t\t\t\t\t// temporary changes to be committed, e.g. if the dialog is canceled.\r\n\t\t\t\t\t\tthis.cleanImageElement = this.imageElement;\r\n\t\t\t\t\t\tthis.imageElement = this.cleanImageElement.clone( true, true );\r\n\r\n\t\t\t\t\t\t// Fill out all fields.\r\n\t\t\t\t\t\tthis.setupContent( IMAGE, this.imageElement );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Refresh LockRatio button\r\n\t\t\t\t\tswitchLockRatio( this, true );\r\n\r\n\t\t\t\t\t// Dont show preview if no URL given.\r\n\t\t\t\t\tif ( !CKEDITOR.tools.trim( this.getValueOf( 'info', 'txtUrl' ) ) ) {\r\n\t\t\t\t\t\tthis.preview.removeAttribute( 'src' );\r\n\t\t\t\t\t\tthis.preview.setStyle( 'display', 'none' );\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonOk: function() {\r\n\t\t\t\t\t// Edit existing Image.\r\n\t\t\t\t\tif ( this.imageEditMode ) {\r\n\t\t\t\t\t\tvar imgTagName = this.imageEditMode;\r\n\r\n\t\t\t\t\t\t// Image dialog and Input element.\r\n\t\t\t\t\t\tif ( dialogType == 'image' && imgTagName == 'input' && confirm( editor.lang.image.button2Img ) ) { // jshint ignore:line\r\n\t\t\t\t\t\t\t// Replace INPUT-> IMG\r\n\t\t\t\t\t\t\timgTagName = 'img';\r\n\t\t\t\t\t\t\tthis.imageElement = editor.document.createElement( 'img' );\r\n\t\t\t\t\t\t\tthis.imageElement.setAttribute( 'alt', '' );\r\n\t\t\t\t\t\t\teditor.insertElement( this.imageElement );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// ImageButton dialog and Image element.\r\n\t\t\t\t\t\telse if ( dialogType != 'image' && imgTagName == 'img' && confirm( editor.lang.image.img2Button ) ) { // jshint ignore:line\r\n\t\t\t\t\t\t\t// Replace IMG -> INPUT\r\n\t\t\t\t\t\t\timgTagName = 'input';\r\n\t\t\t\t\t\t\tthis.imageElement = editor.document.createElement( 'input' );\r\n\t\t\t\t\t\t\tthis.imageElement.setAttributes( {\r\n\t\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\t\talt: ''\r\n\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\teditor.insertElement( this.imageElement );\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Restore the original element before all commits.\r\n\t\t\t\t\t\t\tthis.imageElement = this.cleanImageElement;\r\n\t\t\t\t\t\t\tdelete this.cleanImageElement;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Create a new image.\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Image dialog -> create IMG element.\r\n\t\t\t\t\t\tif ( dialogType == 'image' )\r\n\t\t\t\t\t\t\tthis.imageElement = editor.document.createElement( 'img' );\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tthis.imageElement = editor.document.createElement( 'input' );\r\n\t\t\t\t\t\t\tthis.imageElement.setAttribute( 'type', 'image' );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.imageElement.setAttribute( 'alt', '' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Create a new link.\r\n\t\t\t\t\tif ( !this.linkEditMode )\r\n\t\t\t\t\t\tthis.linkElement = editor.document.createElement( 'a' );\r\n\r\n\t\t\t\t\t// Set attributes.\r\n\t\t\t\t\tthis.commitContent( IMAGE, this.imageElement );\r\n\t\t\t\t\tthis.commitContent( LINK, this.linkElement );\r\n\r\n\t\t\t\t\t// Remove empty style attribute.\r\n\t\t\t\t\tif ( !this.imageElement.getAttribute( 'style' ) )\r\n\t\t\t\t\t\tthis.imageElement.removeAttribute( 'style' );\r\n\r\n\t\t\t\t\t// Insert a new Image.\r\n\t\t\t\t\tif ( !this.imageEditMode ) {\r\n\t\t\t\t\t\tif ( this.addLink ) {\r\n\t\t\t\t\t\t\tif ( !this.linkEditMode ) {\r\n\t\t\t\t\t\t\t\t// Insert a new link.\r\n\t\t\t\t\t\t\t\teditor.insertElement( this.linkElement );\r\n\t\t\t\t\t\t\t\tthis.linkElement.append( this.imageElement, false );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// We already have a link in editor.\r\n\t\t\t\t\t\t\t\tif ( this.linkElement.equals( editor.getSelection().getSelectedElement() ) ) {\r\n\t\t\t\t\t\t\t\t\t// If the link is selected outside, replace it's content rather than the link itself. ([<a>foo</a>])\r\n\t\t\t\t\t\t\t\t\tthis.linkElement.setHtml( '' );\r\n\t\t\t\t\t\t\t\t\tthis.linkElement.append( this.imageElement, false );\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// Only inside of the link is selected, so replace it with image. (<a>[foo]</a>, <a>[f]oo</a>)\r\n\t\t\t\t\t\t\t\t\teditor.insertElement( this.imageElement );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\teditor.insertElement( this.imageElement );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Image already exists.\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Add a new link element.\r\n\t\t\t\t\t\tif ( !this.linkEditMode && this.addLink ) {\r\n\t\t\t\t\t\t\teditor.insertElement( this.linkElement );\r\n\t\t\t\t\t\t\tthis.imageElement.appendTo( this.linkElement );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Remove Link, Image exists.\r\n\t\t\t\t\t\telse if ( this.linkEditMode && !this.addLink ) {\r\n\t\t\t\t\t\t\teditor.getSelection().selectElement( this.linkElement );\r\n\t\t\t\t\t\t\teditor.insertElement( this.imageElement );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonLoad: function() {\r\n\t\t\t\t\tif ( dialogType != 'image' )\r\n\t\t\t\t\t\tthis.hidePage( 'Link' ); //Hide Link tab.\r\n\t\t\t\t\tvar doc = this._.element.getDocument();\r\n\r\n\t\t\t\t\tif ( this.getContentElement( 'info', 'ratioLock' ) ) {\r\n\t\t\t\t\t\tthis.addFocusable( doc.getById( btnResetSizeId ), 5 );\r\n\t\t\t\t\t\tthis.addFocusable( doc.getById( btnLockSizesId ), 5 );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.commitContent = commitContent;\r\n\t\t\t\t},\r\n\t\t\t\tonHide: function() {\r\n\t\t\t\t\tif ( this.preview )\r\n\t\t\t\t\t\tthis.commitContent( CLEANUP, this.preview );\r\n\r\n\t\t\t\t\tif ( this.originalElement ) {\r\n\t\t\t\t\t\tthis.originalElement.removeListener( 'load', onImgLoadEvent );\r\n\t\t\t\t\t\tthis.originalElement.removeListener( 'error', onImgLoadErrorEvent );\r\n\t\t\t\t\t\tthis.originalElement.removeListener( 'abort', onImgLoadErrorEvent );\r\n\t\t\t\t\t\tthis.originalElement.remove();\r\n\t\t\t\t\t\tthis.originalElement = false; // Dialog is closed.\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdelete this.imageElement;\r\n\t\t\t\t},\r\n\t\t\t\tcontents: [ {\r\n\t\t\t\t\tid: 'info',\r\n\t\t\t\t\tlabel: editor.lang.image.infoTab,\r\n\t\t\t\t\taccessKey: 'I',\r\n\t\t\t\t\telements: [ {\r\n\t\t\t\t\t\ttype: 'vbox',\r\n\t\t\t\t\t\tpadding: 0,\r\n\t\t\t\t\t\tchildren: [ {\r\n\t\t\t\t\t\t\ttype: 'hbox',\r\n\t\t\t\t\t\t\twidths: [ '280px', '110px' ],\r\n\t\t\t\t\t\t\talign: 'right',\r\n\t\t\t\t\t\t\tclassName: 'cke_dialog_image_url',\r\n\t\t\t\t\t\t\tchildren: [ {\r\n\t\t\t\t\t\t\t\tid: 'txtUrl',\r\n\t\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\t\tlabel: editor.lang.common.url,\r\n\t\t\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\t\t\tvar dialog = this.getDialog(),\r\n\t\t\t\t\t\t\t\t\t\tnewUrl = this.getValue();\r\n\r\n\t\t\t\t\t\t\t\t\t// Update original image.\r\n\t\t\t\t\t\t\t\t\t// Prevent from load before onShow.\r\n\t\t\t\t\t\t\t\t\tif ( newUrl.length > 0 ) {\r\n\t\t\t\t\t\t\t\t\t\tdialog = this.getDialog();\r\n\t\t\t\t\t\t\t\t\t\tvar original = dialog.originalElement;\r\n\r\n\t\t\t\t\t\t\t\t\t\tif ( dialog.preview ) {\r\n\t\t\t\t\t\t\t\t\t\t\tdialog.preview.removeStyle( 'display' );\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\toriginal.setCustomData( 'isReady', 'false' );\r\n\t\t\t\t\t\t\t\t\t\t// Show loader.\r\n\t\t\t\t\t\t\t\t\t\tvar loader = CKEDITOR.document.getById( imagePreviewLoaderId );\r\n\t\t\t\t\t\t\t\t\t\tif ( loader )\r\n\t\t\t\t\t\t\t\t\t\t\tloader.setStyle( 'display', '' );\r\n\r\n\t\t\t\t\t\t\t\t\t\toriginal.on( 'load', onImgLoadEvent, dialog );\r\n\t\t\t\t\t\t\t\t\t\toriginal.on( 'error', onImgLoadErrorEvent, dialog );\r\n\t\t\t\t\t\t\t\t\t\toriginal.on( 'abort', onImgLoadErrorEvent, dialog );\r\n\t\t\t\t\t\t\t\t\t\toriginal.setAttribute( 'src', newUrl );\r\n\r\n\t\t\t\t\t\t\t\t\t\tif ( dialog.preview ) {\r\n\t\t\t\t\t\t\t\t\t\t\t// Query the preloader to figure out the url impacted by based href.\r\n\t\t\t\t\t\t\t\t\t\t\tpreviewPreloader.setAttribute( 'src', newUrl );\r\n\t\t\t\t\t\t\t\t\t\t\tdialog.preview.setAttribute( 'src', previewPreloader.$.src );\r\n\t\t\t\t\t\t\t\t\t\t\tupdatePreview( dialog );\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// Dont show preview if no URL given.\r\n\t\t\t\t\t\t\t\t\telse if ( dialog.preview ) {\r\n\t\t\t\t\t\t\t\t\t\tdialog.preview.removeAttribute( 'src' );\r\n\t\t\t\t\t\t\t\t\t\tdialog.preview.setStyle( 'display', 'none' );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\t\tvar url = element.data( 'cke-saved-src' ) || element.getAttribute( 'src' );\r\n\t\t\t\t\t\t\t\t\t\tvar field = this;\r\n\r\n\t\t\t\t\t\t\t\t\t\tthis.getDialog().dontResetSize = true;\r\n\r\n\t\t\t\t\t\t\t\t\t\tfield.setValue( url ); // And call this.onChange()\r\n\t\t\t\t\t\t\t\t\t\t// Manually set the initial value.(#4191)\r\n\t\t\t\t\t\t\t\t\t\tfield.setInitValue();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\tif ( type == IMAGE && ( this.getValue() || this.isChanged() ) ) {\r\n\t\t\t\t\t\t\t\t\t\telement.data( 'cke-saved-src', this.getValue() );\r\n\t\t\t\t\t\t\t\t\t\telement.setAttribute( 'src', this.getValue() );\r\n\t\t\t\t\t\t\t\t\t} else if ( type == CLEANUP ) {\r\n\t\t\t\t\t\t\t\t\t\telement.setAttribute( 'src', '' ); // If removeAttribute doesn't work.\r\n\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'src' );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tvalidate: CKEDITOR.dialog.validate.notEmpty( editor.lang.image.urlMissing )\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttype: 'hbox',\r\n                                    children: [\r\n                                        /*{\r\n                                            type: 'button',\r\n                                            id: 'browse',\r\n                                            // v-align with the 'txtUrl' field.\r\n                                            // TODO: We need something better than a fixed size here.\r\n                                            style: 'display:inline-block;margin-top:14px;',\r\n                                            align: 'center',\r\n                                            label: editor.lang.common.browseServer,\r\n                                            hidden: true,\r\n                                            filebrowser: 'info:txtUrl'\r\n                                        },*/\r\n                                        {\r\n                                            type: 'html',\r\n\t\t\t\t\t\t\t\t\t\t\thtml: '<a class=\"cke_dialog_ui_button\" style=\"display:inline-block;margin-top:14px;margin-right:-150px\"><span class=\"cke_dialog_ui_button\">'+editor.lang.image.btnUpload+'</span></a>'\r\n                                        },\r\n                                        {\r\n                                            type: 'file',\r\n                                            id: 'upload',\r\n                                            label: editor.lang.image.btnUpload,\r\n                                            style: 'width:150px;height:40px;opacity:0;position:relative;left:-20px',\r\n                                            size: 38,\r\n                                            onChange: function() {\r\n                                                this._.buttons[0].fire('click');\r\n                                            }\r\n                                        },\r\n                                        {\r\n                                            type: 'fileButton',\r\n                                            id: 'uploadButton',\r\n                                            style: 'display:none',\r\n                                            filebrowser: 'info:txtUrl',\r\n                                            label: editor.lang.image.btnUpload,\r\n                                            'for': [ 'info', 'upload' ]\r\n                                        }\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t} ]\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tid: 'txtAlt',\r\n\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\tlabel: editor.lang.image.alt,\r\n\t\t\t\t\t\taccessKey: 'T',\r\n\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\tupdatePreview( this.getDialog() );\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\tif ( type == IMAGE )\r\n\t\t\t\t\t\t\t\tthis.setValue( element.getAttribute( 'alt' ) );\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\tif ( this.getValue() || this.isChanged() )\r\n\t\t\t\t\t\t\t\t\telement.setAttribute( 'alt', this.getValue() );\r\n\t\t\t\t\t\t\t} else if ( type == PREVIEW )\r\n\t\t\t\t\t\t\t\telement.setAttribute( 'alt', this.getValue() );\r\n\t\t\t\t\t\t\telse if ( type == CLEANUP ) {\r\n\t\t\t\t\t\t\t\telement.removeAttribute( 'alt' );\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'hbox',\r\n\t\t\t\t\t\tchildren: [ {\r\n\t\t\t\t\t\t\tid: 'basic',\r\n\t\t\t\t\t\t\ttype: 'vbox',\r\n\t\t\t\t\t\t\tchildren: [ {\r\n\t\t\t\t\t\t\t\ttype: 'hbox',\r\n\t\t\t\t\t\t\t\trequiredContent: 'img{width,height}',\r\n\t\t\t\t\t\t\t\twidths: [ '50%', '50%' ],\r\n\t\t\t\t\t\t\t\tchildren: [ {\r\n\t\t\t\t\t\t\t\t\ttype: 'vbox',\r\n\t\t\t\t\t\t\t\t\tpadding: 1,\r\n\t\t\t\t\t\t\t\t\tchildren: [ {\r\n\t\t\t\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\t\t\t\twidth: '45px',\r\n\t\t\t\t\t\t\t\t\t\tid: 'txtWidth',\r\n\t\t\t\t\t\t\t\t\t\tlabel: editor.lang.common.width,\r\n\t\t\t\t\t\t\t\t\t\tonKeyUp: onSizeChange,\r\n\t\t\t\t\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\t\t\t\t\tcommitInternally.call( this, 'advanced:txtdlgGenStyle' );\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tvalidate: function() {\r\n\t\t\t\t\t\t\t\t\t\t\tvar aMatch = this.getValue().match( regexGetSizeOrEmpty ),\r\n\t\t\t\t\t\t\t\t\t\t\t\tisValid = !!( aMatch && parseInt( aMatch[ 1 ], 10 ) !== 0 );\r\n\t\t\t\t\t\t\t\t\t\t\tif ( !isValid )\r\n\t\t\t\t\t\t\t\t\t\t\t\talert( editor.lang.common.invalidWidth ); // jshint ignore:line\r\n\t\t\t\t\t\t\t\t\t\t\treturn isValid;\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tsetup: setupDimension,\r\n\t\t\t\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar value = this.getValue();\r\n\t\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ( value && editor.activeFilter.check( 'img{width,height}' ) )\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'width', CKEDITOR.tools.cssLength( value ) );\r\n\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'width' );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'width' );\r\n\t\t\t\t\t\t\t\t\t\t\t} else if ( type == PREVIEW ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar aMatch = value.match( regexGetSize );\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ( !aMatch ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar oImageOriginal = this.getDialog().originalElement;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ( oImageOriginal.getCustomData( 'isReady' ) == 'true' )\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'width', oImageOriginal.$.width + 'px' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'width', CKEDITOR.tools.cssLength( value ) );\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t} else if ( type == CLEANUP ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'width' );\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'width' );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\t\t\t\tid: 'txtHeight',\r\n\t\t\t\t\t\t\t\t\t\twidth: '45px',\r\n\t\t\t\t\t\t\t\t\t\tlabel: editor.lang.common.height,\r\n\t\t\t\t\t\t\t\t\t\tonKeyUp: onSizeChange,\r\n\t\t\t\t\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\t\t\t\t\tcommitInternally.call( this, 'advanced:txtdlgGenStyle' );\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tvalidate: function() {\r\n\t\t\t\t\t\t\t\t\t\t\tvar aMatch = this.getValue().match( regexGetSizeOrEmpty ),\r\n\t\t\t\t\t\t\t\t\t\t\t\tisValid = !!( aMatch && parseInt( aMatch[ 1 ], 10 ) !== 0 );\r\n\t\t\t\t\t\t\t\t\t\t\tif ( !isValid )\r\n\t\t\t\t\t\t\t\t\t\t\t\talert( editor.lang.common.invalidHeight ); // jshint ignore:line\r\n\t\t\t\t\t\t\t\t\t\t\treturn isValid;\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tsetup: setupDimension,\r\n\t\t\t\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar value = this.getValue();\r\n\t\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ( value && editor.activeFilter.check( 'img{width,height}' ) )\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'height', CKEDITOR.tools.cssLength( value ) );\r\n\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'height' );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'height' );\r\n\t\t\t\t\t\t\t\t\t\t\t} else if ( type == PREVIEW ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar aMatch = value.match( regexGetSize );\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ( !aMatch ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar oImageOriginal = this.getDialog().originalElement;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ( oImageOriginal.getCustomData( 'isReady' ) == 'true' )\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'height', oImageOriginal.$.height + 'px' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'height', CKEDITOR.tools.cssLength( value ) );\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t} else if ( type == CLEANUP ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'height' );\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'height' );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} ]\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tid: 'ratioLock',\r\n\t\t\t\t\t\t\t\t\ttype: 'html',\r\n\t\t\t\t\t\t\t\t\tclassName: 'cke_dialog_image_ratiolock',\r\n\t\t\t\t\t\t\t\t\tstyle: 'margin-top:30px;width:40px;height:40px;',\r\n\t\t\t\t\t\t\t\t\tonLoad: function() {\r\n\t\t\t\t\t\t\t\t\t\t// Activate Reset button\r\n\t\t\t\t\t\t\t\t\t\tvar resetButton = CKEDITOR.document.getById( btnResetSizeId ),\r\n\t\t\t\t\t\t\t\t\t\t\tratioButton = CKEDITOR.document.getById( btnLockSizesId );\r\n\t\t\t\t\t\t\t\t\t\tif ( resetButton ) {\r\n\t\t\t\t\t\t\t\t\t\t\tresetButton.on( 'click', function( evt ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tresetSize( this );\r\n\t\t\t\t\t\t\t\t\t\t\t\tevt.data && evt.data.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\t\t}, this.getDialog() );\r\n\t\t\t\t\t\t\t\t\t\t\tresetButton.on( 'mouseover', function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.addClass( 'cke_btn_over' );\r\n\t\t\t\t\t\t\t\t\t\t\t}, resetButton );\r\n\t\t\t\t\t\t\t\t\t\t\tresetButton.on( 'mouseout', function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.removeClass( 'cke_btn_over' );\r\n\t\t\t\t\t\t\t\t\t\t\t}, resetButton );\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t// Activate (Un)LockRatio button\r\n\t\t\t\t\t\t\t\t\t\tif ( ratioButton ) {\r\n\t\t\t\t\t\t\t\t\t\t\tratioButton.on( 'click', function( evt ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tswitchLockRatio( this );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar oImageOriginal = this.originalElement,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twidth = this.getValueOf( 'info', 'txtWidth' );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ( oImageOriginal.getCustomData( 'isReady' ) == 'true' && width ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar height = oImageOriginal.$.height / oImageOriginal.$.width * width;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ( !isNaN( height ) ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.setValueOf( 'info', 'txtHeight', Math.round( height ) );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tupdatePreview( this );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tevt.data && evt.data.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\t\t}, this.getDialog() );\r\n\t\t\t\t\t\t\t\t\t\t\tratioButton.on( 'mouseover', function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.addClass( 'cke_btn_over' );\r\n\t\t\t\t\t\t\t\t\t\t\t}, ratioButton );\r\n\t\t\t\t\t\t\t\t\t\t\tratioButton.on( 'mouseout', function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.removeClass( 'cke_btn_over' );\r\n\t\t\t\t\t\t\t\t\t\t\t}, ratioButton );\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\thtml: '<div>' +\r\n\t\t\t\t\t\t\t\t\t\t'<a href=\"javascript:void(0)\" tabindex=\"-1\" title=\"' + editor.lang.image.lockRatio +\r\n\t\t\t\t\t\t\t\t\t\t'\" class=\"cke_btn_locked\" id=\"' + btnLockSizesId + '\" role=\"checkbox\"><span class=\"cke_icon\"></span><span class=\"cke_label\">' + editor.lang.image.lockRatio + '</span></a>' +\r\n\t\t\t\t\t\t\t\t\t\t'<a href=\"javascript:void(0)\" tabindex=\"-1\" title=\"' + editor.lang.image.resetSize +\r\n\t\t\t\t\t\t\t\t\t\t'\" class=\"cke_btn_reset\" id=\"' + btnResetSizeId + '\" role=\"button\"><span class=\"cke_label\">' + editor.lang.image.resetSize + '</span></a>' +\r\n\t\t\t\t\t\t\t\t\t\t'</div>'\r\n\t\t\t\t\t\t\t\t} ]\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttype: 'vbox',\r\n\t\t\t\t\t\t\t\tpadding: 1,\r\n\t\t\t\t\t\t\t\tchildren: [ {\r\n\t\t\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\t\t\tid: 'txtBorder',\r\n\t\t\t\t\t\t\t\t\trequiredContent: 'img{border-width}',\r\n\t\t\t\t\t\t\t\t\twidth: '60px',\r\n\t\t\t\t\t\t\t\t\tlabel: editor.lang.image.border,\r\n\t\t\t\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\t\t\t\tonKeyUp: function() {\r\n\t\t\t\t\t\t\t\t\t\tupdatePreview( this.getDialog() );\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\t\t\t\tcommitInternally.call( this, 'advanced:txtdlgGenStyle' );\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tvalidate: CKEDITOR.dialog.validate.integer( editor.lang.image.validateBorder ),\r\n\t\t\t\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar value,\r\n\t\t\t\t\t\t\t\t\t\t\t\tborderStyle = element.getStyle( 'border-width' );\r\n\t\t\t\t\t\t\t\t\t\t\tborderStyle = borderStyle && borderStyle.match( /^(\\d+px)(?: \\1 \\1 \\1)?$/ );\r\n\t\t\t\t\t\t\t\t\t\t\tvalue = borderStyle && parseInt( borderStyle[ 1 ], 10 );\r\n\t\t\t\t\t\t\t\t\t\t\tisNaN( parseInt( value, 10 ) ) && ( value = element.getAttribute( 'border' ) );\r\n\t\t\t\t\t\t\t\t\t\t\tthis.setValue( value );\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\t\tvar value = parseInt( this.getValue(), 10 );\r\n\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE || type == PREVIEW ) {\r\n\t\t\t\t\t\t\t\t\t\t\tif ( !isNaN( value ) ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'border-width', CKEDITOR.tools.cssLength( value ) );\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'border-style', 'solid' );\r\n\t\t\t\t\t\t\t\t\t\t\t} else if ( !value && this.isChanged() ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'border' );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE )\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'border' );\r\n\t\t\t\t\t\t\t\t\t\t} else if ( type == CLEANUP ) {\r\n\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'border' );\r\n\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'border-width' );\r\n\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'border-style' );\r\n\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'border-color' );\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tid: 'cmbAlign',\r\n\t\t\t\t\t\t\t\t\trequiredContent: 'img{float}',\r\n\t\t\t\t\t\t\t\t\ttype: 'select',\r\n\t\t\t\t\t\t\t\t\twidths: [ '35%', '65%' ],\r\n\t\t\t\t\t\t\t\t\tstyle: 'width:90px',\r\n\t\t\t\t\t\t\t\t\tlabel: editor.lang.common.align,\r\n\t\t\t\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\t\t\t\titems: [\r\n\t\t\t\t\t\t\t\t\t\t[ editor.lang.common.notSet, '' ],\r\n\t\t\t\t\t\t\t\t\t\t[ editor.lang.common.alignLeft, 'left' ],\r\n\t\t\t\t\t\t\t\t\t\t[ editor.lang.common.alignRight, 'right' ]\r\n\t\t\t\t\t\t\t\t\t\t// Backward compatible with v2 on setup when specified as attribute value,\r\n\t\t\t\t\t\t\t\t\t\t// while these values are no more available as select options.\r\n\t\t\t\t\t\t\t\t\t\t//\t[ editor.lang.image.alignAbsBottom , 'absBottom'],\r\n\t\t\t\t\t\t\t\t\t\t//\t[ editor.lang.image.alignAbsMiddle , 'absMiddle'],\r\n\t\t\t\t\t\t\t\t\t\t//  [ editor.lang.image.alignBaseline , 'baseline'],\r\n\t\t\t\t\t\t\t\t\t\t//  [ editor.lang.image.alignTextTop , 'text-top'],\r\n\t\t\t\t\t\t\t\t\t\t//  [ editor.lang.image.alignBottom , 'bottom'],\r\n\t\t\t\t\t\t\t\t\t\t//  [ editor.lang.image.alignMiddle , 'middle'],\r\n\t\t\t\t\t\t\t\t\t\t//  [ editor.lang.image.alignTop , 'top']\r\n\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\t\t\t\tupdatePreview( this.getDialog() );\r\n\t\t\t\t\t\t\t\t\t\tcommitInternally.call( this, 'advanced:txtdlgGenStyle' );\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar value = element.getStyle( 'float' );\r\n\t\t\t\t\t\t\t\t\t\t\tswitch ( value ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Ignore those unrelated values.\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'inherit':\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'none':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue = '';\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t!value && ( value = ( element.getAttribute( 'align' ) || '' ).toLowerCase() );\r\n\t\t\t\t\t\t\t\t\t\t\tthis.setValue( value );\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\t\tvar value = this.getValue();\r\n\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE || type == PREVIEW ) {\r\n\t\t\t\t\t\t\t\t\t\t\tif ( value )\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'float', value );\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'float' );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue = ( element.getAttribute( 'align' ) || '' ).toLowerCase();\r\n\t\t\t\t\t\t\t\t\t\t\t\tswitch ( value ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// we should remove it only if it matches \"left\" or \"right\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// otherwise leave it intact.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'left':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'right':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'align' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else if ( type == CLEANUP ) {\r\n\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'float' );\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttype: 'html',\r\n\t\t\t\t\t\t\t\t\thtml: '<label style=\"position: relative;top: 1.3em\">'+editor.lang.image.hSpace+'</label>'\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttype: 'hbox',\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\t\t\t\t\tid: 'txtSpaceLeft',\r\n\t\t\t\t\t\t\t\t\t\t\trequiredContent: 'img{margin-left}',\r\n\t\t\t\t\t\t\t\t\t\t\twidth: '60px',\r\n\t\t\t\t\t\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\t\t\t\t\t\tonKeyUp: function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\tupdatePreview( this.getDialog() );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\tcommitInternally.call( this, 'advanced:txtdlgGenStyle' );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tvalidate: CKEDITOR.dialog.validate.integer( editor.lang.image.validateVSpace ),\r\n\t\t\t\t\t\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar value,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmarginLeftStyle = element.getStyle( 'margin-left' );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmarginLeftStyle = marginLeftStyle && marginLeftStyle.match( pxLengthRegex );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue = parseInt( marginLeftStyle, 10 );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.setValue( value );\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar value = parseInt( this.getValue(), 10 );\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE || type == PREVIEW ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ( !isNaN( value ) ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'margin-left', CKEDITOR.tools.cssLength( value ) );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if ( !value && this.isChanged() ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'margin-left' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE )\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'vspace' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else if ( type == CLEANUP ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'vspace' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'margin-left' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\t\t\t\t\tid: 'txtSpaceRight',\r\n\t\t\t\t\t\t\t\t\t\t\trequiredContent: 'img{margin-right}',\r\n\t\t\t\t\t\t\t\t\t\t\twidth: '60px',\r\n\t\t\t\t\t\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\t\t\t\t\t\tonKeyUp: function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\tupdatePreview( this.getDialog() );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\tcommitInternally.call( this, 'advanced:txtdlgGenStyle' );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tvalidate: CKEDITOR.dialog.validate.integer( editor.lang.image.validateVSpace ),\r\n\t\t\t\t\t\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar value,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmarginRightStyle = element.getStyle( 'margin-right' );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmarginRightStyle = marginRightStyle && marginRightStyle.match( pxLengthRegex );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue = parseInt( marginRightStyle, 10 );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.setValue( value );\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar value = parseInt( this.getValue(), 10 );\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE || type == PREVIEW ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ( !isNaN( value ) ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telement.setStyle( 'margin-right', CKEDITOR.tools.cssLength( value ) );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if ( !value && this.isChanged() ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'margin-right' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ( type == IMAGE )\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'vspace' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else if ( type == CLEANUP ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeAttribute( 'vspace' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telement.removeStyle( 'margin-right' );\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttype: 'html',\r\n                                    html: '<label style=\"position: relative;top: 1.3em\">'+editor.lang.image.vSpace+'</label>'\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttype: 'hbox',\r\n                                    children: [\r\n                                        {\r\n                                            type: 'text',\r\n                                            id: 'txtSpaceTop',\r\n                                            requiredContent: 'img{margin-top}',\r\n                                            width: '60px',\r\n                                            'default': '',\r\n                                            onKeyUp: function() {\r\n                                                updatePreview( this.getDialog() );\r\n                                            },\r\n                                            onChange: function() {\r\n                                                commitInternally.call( this, 'advanced:txtdlgGenStyle' );\r\n                                            },\r\n                                            validate: CKEDITOR.dialog.validate.integer( editor.lang.image.validateVSpace ),\r\n                                            setup: function( type, element ) {\r\n                                                if ( type == IMAGE ) {\r\n                                                    var value,\r\n                                                        marginTopStyle = element.getStyle( 'margin-top' );\r\n\r\n                                                    marginTopStyle = marginTopStyle && marginTopStyle.match( pxLengthRegex );\r\n                                                    value = parseInt( marginTopStyle, 10 );\r\n\r\n                                                    this.setValue( value );\r\n                                                }\r\n                                            },\r\n                                            commit: function( type, element ) {\r\n                                                var value = parseInt( this.getValue(), 10 );\r\n                                                if ( type == IMAGE || type == PREVIEW ) {\r\n                                                    if ( !isNaN( value ) ) {\r\n                                                        element.setStyle( 'margin-top', CKEDITOR.tools.cssLength( value ) );\r\n                                                    } else if ( !value && this.isChanged() ) {\r\n                                                        element.removeStyle( 'margin-top' );\r\n                                                    }\r\n\r\n                                                    if ( type == IMAGE )\r\n                                                        element.removeAttribute( 'vspace' );\r\n                                                } else if ( type == CLEANUP ) {\r\n                                                    element.removeAttribute( 'vspace' );\r\n                                                    element.removeStyle( 'margin-top' );\r\n                                                }\r\n                                            }\r\n                                        },\r\n                                        {\r\n                                            type: 'text',\r\n                                            id: 'txtSpaceBottom',\r\n                                            requiredContent: 'img{margin-bottom}',\r\n                                            width: '60px',\r\n                                            'default': '',\r\n                                            onKeyUp: function() {\r\n                                                updatePreview( this.getDialog() );\r\n                                            },\r\n                                            onChange: function() {\r\n                                                commitInternally.call( this, 'advanced:txtdlgGenStyle' );\r\n                                            },\r\n                                            validate: CKEDITOR.dialog.validate.integer( editor.lang.image.validateVSpace ),\r\n                                            setup: function( type, element ) {\r\n                                                if ( type == IMAGE ) {\r\n                                                    var value,\r\n                                                        marginBottomStyle = element.getStyle( 'margin-bottom' );\r\n\r\n                                                    marginBottomStyle = marginBottomStyle && marginBottomStyle.match( pxLengthRegex );\r\n                                                    value = parseInt( marginBottomStyle, 10 );\r\n\r\n                                                    this.setValue( value );\r\n                                                }\r\n                                            },\r\n                                            commit: function( type, element ) {\r\n                                                var value = parseInt( this.getValue(), 10 );\r\n                                                if ( type == IMAGE || type == PREVIEW ) {\r\n                                                    if ( !isNaN( value ) ) {\r\n                                                        element.setStyle( 'margin-bottom', CKEDITOR.tools.cssLength( value ) );\r\n                                                    } else if ( !value && this.isChanged() ) {\r\n                                                        element.removeStyle( 'margin-bottom' );\r\n                                                    }\r\n\r\n                                                    if ( type == IMAGE )\r\n                                                        element.removeAttribute( 'vspace' );\r\n                                                } else if ( type == CLEANUP ) {\r\n                                                    element.removeAttribute( 'vspace' );\r\n                                                    element.removeStyle( 'margin-bottom' );\r\n                                                }\r\n                                            }\r\n                                        }\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t} ]\r\n\t\t\t\t\t\t\t} ]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: 'vbox',\r\n\t\t\t\t\t\t\theight: '250px',\r\n\t\t\t\t\t\t\tchildren: [ {\r\n\t\t\t\t\t\t\t\ttype: 'html',\r\n\t\t\t\t\t\t\t\tid: 'htmlPreview',\r\n\t\t\t\t\t\t\t\tstyle: 'width:95%;',\r\n\t\t\t\t\t\t\t\thtml: '<div>' + CKEDITOR.tools.htmlEncode( editor.lang.common.preview ) + '<br>' +\r\n\t\t\t\t\t\t\t\t\t'<div id=\"' + imagePreviewLoaderId + '\" class=\"ImagePreviewLoader\" style=\"display:none\"><div class=\"loading\">&nbsp;</div></div>' +\r\n\t\t\t\t\t\t\t\t\t'<div class=\"ImagePreviewBox\"><table><tr><td>' +\r\n\t\t\t\t\t\t\t\t\t\t'<a href=\"javascript:void(0)\" target=\"_blank\" onclick=\"return false;\" id=\"' + previewLinkId + '\">' +\r\n\t\t\t\t\t\t\t\t\t\t'<img id=\"' + previewImageId + '\" alt=\"\" /></a>' +\r\n\t\t\t\t\t\t\t\t\t// jscs:disable maximumLineLength\r\n\t\t\t\t\t\t\t\t\t\t( editor.config.image_previewText || 'Lorem ipsum dolor sit amet, consectetuer adipiscing elit. ' +\r\n\t\t\t\t\t\t\t\t\t\t\t'Maecenas feugiat consequat diam. Maecenas metus. Vivamus diam purus, cursus a, commodo non, facilisis vitae, ' +\r\n\t\t\t\t\t\t\t\t\t\t\t'nulla. Aenean dictum lacinia tortor. Nunc iaculis, nibh non iaculis aliquam, orci felis euismod neque, sed ornare massa mauris sed velit. Nulla pretium mi et risus. Fusce mi pede, tempor id, cursus ac, ullamcorper nec, enim. Sed tortor. Curabitur molestie. Duis velit augue, condimentum at, ultrices a, luctus ut, orci. Donec pellentesque egestas eros. Integer cursus, augue in cursus faucibus, eros pede bibendum sem, in tempus tellus justo quis ligula. Etiam eget tortor. Vestibulum rutrum, est ut placerat elementum, lectus nisl aliquam velit, tempor aliquam eros nunc nonummy metus. In eros metus, gravida a, gravida sed, lobortis id, turpis. Ut ultrices, ipsum at venenatis fringilla, sem nulla lacinia tellus, eget aliquet turpis mauris non enim. Nam turpis. Suspendisse lacinia. Curabitur ac tortor ut ipsum egestas elementum. Nunc imperdiet gravida mauris.' ) +\r\n\t\t\t\t\t\t\t\t\t// jscs:enable maximumLineLength\r\n\t\t\t\t\t\t\t\t\t'</td></tr></table></div></div>'\r\n\t\t\t\t\t\t\t} ]\r\n\t\t\t\t\t\t} ]\r\n\t\t\t\t\t} ]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: 'Link',\r\n\t\t\t\t\trequiredContent: 'a[href]',\r\n\t\t\t\t\tlabel: editor.lang.image.linkTab,\r\n\t\t\t\t\tpadding: 0,\r\n\t\t\t\t\telements: [ {\r\n\t\t\t\t\t\tid: 'txtUrl',\r\n\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\tlabel: editor.lang.common.url,\r\n\t\t\t\t\t\tstyle: 'width: 100%',\r\n\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\tif ( type == LINK ) {\r\n\t\t\t\t\t\t\t\tvar href = element.data( 'cke-saved-href' );\r\n\t\t\t\t\t\t\t\tif ( !href )\r\n\t\t\t\t\t\t\t\t\thref = element.getAttribute( 'href' );\r\n\t\t\t\t\t\t\t\tthis.setValue( href );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\tif ( type == LINK ) {\r\n\t\t\t\t\t\t\t\tif ( this.getValue() || this.isChanged() ) {\r\n\t\t\t\t\t\t\t\t\tvar url = this.getValue();\r\n\t\t\t\t\t\t\t\t\telement.data( 'cke-saved-href', url );\r\n\t\t\t\t\t\t\t\t\telement.setAttribute( 'href', url );\r\n\r\n\t\t\t\t\t\t\t\t\tif ( this.getValue() || !editor.config.image_removeLinkByEmptyURL )\r\n\t\t\t\t\t\t\t\t\t\tthis.getDialog().addLink = true;\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\tthis.getDialog().addLink = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'button',\r\n\t\t\t\t\t\tid: 'browse',\r\n\t\t\t\t\t\tclassName: 'cke_dialog_image_browse',\r\n\t\t\t\t\t\tfilebrowser: {\r\n\t\t\t\t\t\t\taction: 'Browse',\r\n\t\t\t\t\t\t\ttarget: 'Link:txtUrl',\r\n\t\t\t\t\t\t\turl: editor.config.filebrowserImageBrowseLinkUrl\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tstyle: 'float:right',\r\n\t\t\t\t\t\thidden: true,\r\n\t\t\t\t\t\tlabel: editor.lang.common.browseServer\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tid: 'cmbTarget',\r\n\t\t\t\t\t\ttype: 'select',\r\n\t\t\t\t\t\trequiredContent: 'a[target]',\r\n\t\t\t\t\t\tlabel: editor.lang.common.target,\r\n\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\titems: [\r\n\t\t\t\t\t\t\t[ editor.lang.common.notSet, '' ],\r\n\t\t\t\t\t\t\t[ editor.lang.common.targetNew, '_blank' ],\r\n\t\t\t\t\t\t\t[ editor.lang.common.targetTop, '_top' ],\r\n\t\t\t\t\t\t\t[ editor.lang.common.targetSelf, '_self' ],\r\n\t\t\t\t\t\t\t[ editor.lang.common.targetParent, '_parent' ]\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\tif ( type == LINK )\r\n\t\t\t\t\t\t\t\tthis.setValue( element.getAttribute( 'target' ) || '' );\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\tif ( type == LINK ) {\r\n\t\t\t\t\t\t\t\tif ( this.getValue() || this.isChanged() )\r\n\t\t\t\t\t\t\t\t\telement.setAttribute( 'target', this.getValue() );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} ]\r\n\t\t\t\t},\r\n\t\t\t\t/*{\r\n\t\t\t\t\tid: 'Upload',\r\n\t\t\t\t\thidden: true,\r\n\t\t\t\t\tfilebrowser: 'uploadButton',\r\n\t\t\t\t\tlabel: editor.lang.image.upload,\r\n\t\t\t\t\telements: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: 'file',\r\n\t\t\t\t\t\t\tid: 'upload',\r\n\t\t\t\t\t\t\tlabel: editor.lang.image.btnUpload,\r\n\t\t\t\t\t\t\tstyle: 'height:40px',\r\n\t\t\t\t\t\t\tsize: 38,\r\n\t\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\t\tthis._.buttons[0].fire('click');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: 'fileButton',\r\n\t\t\t\t\t\t\tid: 'uploadButton',\r\n\t\t\t\t\t\t\tstyle: 'display:none',\r\n\t\t\t\t\t\t\tfilebrowser: 'info:txtUrl',\r\n\t\t\t\t\t\t\tlabel: editor.lang.image.btnUpload,\r\n\t\t\t\t\t\t\t'for': [ 'Upload', 'upload' ]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t},*/\r\n\t\t\t\t{\r\n\t\t\t\t\tid: 'advanced',\r\n\t\t\t\t\tlabel: editor.lang.common.advancedTab,\r\n\t\t\t\t\telements: [ {\r\n\t\t\t\t\t\ttype: 'hbox',\r\n\t\t\t\t\t\twidths: [ '50%', '25%', '25%' ],\r\n\t\t\t\t\t\tchildren: [ {\r\n\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\tid: 'linkId',\r\n\t\t\t\t\t\t\trequiredContent: 'img[id]',\r\n\t\t\t\t\t\t\tlabel: editor.lang.common.id,\r\n\t\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\t\tif ( type == IMAGE )\r\n\t\t\t\t\t\t\t\t\tthis.setValue( element.getAttribute( 'id' ) );\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\tif ( this.getValue() || this.isChanged() )\r\n\t\t\t\t\t\t\t\t\t\telement.setAttribute( 'id', this.getValue() );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: 'cmbLangDir',\r\n\t\t\t\t\t\t\ttype: 'select',\r\n\t\t\t\t\t\t\trequiredContent: 'img[dir]',\r\n\t\t\t\t\t\t\tstyle: 'width : 100px;',\r\n\t\t\t\t\t\t\tlabel: editor.lang.common.langDir,\r\n\t\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\t\titems: [\r\n\t\t\t\t\t\t\t\t[ editor.lang.common.notSet, '' ],\r\n\t\t\t\t\t\t\t\t[ editor.lang.common.langDirLtr, 'ltr' ],\r\n\t\t\t\t\t\t\t\t[ editor.lang.common.langDirRtl, 'rtl' ]\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\t\tif ( type == IMAGE )\r\n\t\t\t\t\t\t\t\t\tthis.setValue( element.getAttribute( 'dir' ) );\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\tif ( this.getValue() || this.isChanged() )\r\n\t\t\t\t\t\t\t\t\t\telement.setAttribute( 'dir', this.getValue() );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\tid: 'txtLangCode',\r\n\t\t\t\t\t\t\trequiredContent: 'img[lang]',\r\n\t\t\t\t\t\t\tlabel: editor.lang.common.langCode,\r\n\t\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\t\tif ( type == IMAGE )\r\n\t\t\t\t\t\t\t\t\tthis.setValue( element.getAttribute( 'lang' ) );\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\tif ( this.getValue() || this.isChanged() )\r\n\t\t\t\t\t\t\t\t\t\telement.setAttribute( 'lang', this.getValue() );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} ]\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\tid: 'txtGenLongDescr',\r\n\t\t\t\t\t\trequiredContent: 'img[longdesc]',\r\n\t\t\t\t\t\tlabel: editor.lang.common.longDescr,\r\n\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\tif ( type == IMAGE )\r\n\t\t\t\t\t\t\t\tthis.setValue( element.getAttribute( 'longDesc' ) );\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\tif ( this.getValue() || this.isChanged() )\r\n\t\t\t\t\t\t\t\t\telement.setAttribute( 'longDesc', this.getValue() );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'hbox',\r\n\t\t\t\t\t\twidths: [ '50%', '50%' ],\r\n\t\t\t\t\t\tchildren: [ {\r\n\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\tid: 'txtGenClass',\r\n\t\t\t\t\t\t\trequiredContent: 'img(cke-xyz)', // Random text like 'xyz' will check if all are allowed.\r\n\t\t\t\t\t\t\tlabel: editor.lang.common.cssClass,\r\n\t\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\t\tif ( type == IMAGE )\r\n\t\t\t\t\t\t\t\t\tthis.setValue( element.getAttribute( 'class' ) );\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\tif ( this.getValue() || this.isChanged() )\r\n\t\t\t\t\t\t\t\t\t\telement.setAttribute( 'class', this.getValue() );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\tid: 'txtGenTitle',\r\n\t\t\t\t\t\t\trequiredContent: 'img[title]',\r\n\t\t\t\t\t\t\tlabel: editor.lang.common.advisoryTitle,\r\n\t\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\t\tupdatePreview( this.getDialog() );\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\t\tif ( type == IMAGE )\r\n\t\t\t\t\t\t\t\t\tthis.setValue( element.getAttribute( 'title' ) );\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\t\tif ( this.getValue() || this.isChanged() )\r\n\t\t\t\t\t\t\t\t\t\telement.setAttribute( 'title', this.getValue() );\r\n\t\t\t\t\t\t\t\t} else if ( type == PREVIEW )\r\n\t\t\t\t\t\t\t\t\telement.setAttribute( 'title', this.getValue() );\r\n\t\t\t\t\t\t\t\telse if ( type == CLEANUP ) {\r\n\t\t\t\t\t\t\t\t\telement.removeAttribute( 'title' );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} ]\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\tid: 'txtdlgGenStyle',\r\n\t\t\t\t\t\trequiredContent: 'img{cke-xyz}', // Random text like 'xyz' will check if all are allowed.\r\n\t\t\t\t\t\tlabel: editor.lang.common.cssStyle,\r\n\t\t\t\t\t\tvalidate: CKEDITOR.dialog.validate.inlineStyle( editor.lang.common.invalidInlineStyle ),\r\n\t\t\t\t\t\t'default': '',\r\n\t\t\t\t\t\tsetup: function( type, element ) {\r\n\t\t\t\t\t\t\tif ( type == IMAGE ) {\r\n\t\t\t\t\t\t\t\tvar genStyle = element.getAttribute( 'style' );\r\n\t\t\t\t\t\t\t\tif ( !genStyle && element.$.style.cssText )\r\n\t\t\t\t\t\t\t\t\tgenStyle = element.$.style.cssText;\r\n\t\t\t\t\t\t\t\tthis.setValue( genStyle );\r\n\r\n\t\t\t\t\t\t\t\tvar height = element.$.style.height,\r\n\t\t\t\t\t\t\t\t\twidth = element.$.style.width,\r\n\t\t\t\t\t\t\t\t\taMatchH = ( height ? height : '' ).match( regexGetSize ),\r\n\t\t\t\t\t\t\t\t\taMatchW = ( width ? width : '' ).match( regexGetSize );\r\n\r\n\t\t\t\t\t\t\t\tthis.attributesInStyle = {\r\n\t\t\t\t\t\t\t\t\theight: !!aMatchH,\r\n\t\t\t\t\t\t\t\t\twidth: !!aMatchW\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonChange: function() {\r\n\t\t\t\t\t\t\tcommitInternally.call(\r\n\t\t\t\t\t\t\t\tthis, [\r\n\t\t\t\t\t\t\t\t\t'info:cmbFloat',\r\n\t\t\t\t\t\t\t\t\t'info:cmbAlign',\r\n\t\t\t\t\t\t\t\t\t'info:txtVSpace',\r\n\t\t\t\t\t\t\t\t\t'info:txtHSpace',\r\n\t\t\t\t\t\t\t\t\t'info:txtBorder',\r\n\t\t\t\t\t\t\t\t\t'info:txtWidth',\r\n\t\t\t\t\t\t\t\t\t'info:txtHeight'\r\n\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tupdatePreview( this );\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcommit: function( type, element ) {\r\n\t\t\t\t\t\t\tif ( type == IMAGE && ( this.getValue() || this.isChanged() ) )\r\n\t\t\t\t\t\t\t\telement.setAttribute( 'style', this.getValue() );\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} ]\r\n\t\t\t\t} ]\r\n\t\t\t};\r\n\t\t};\r\n\r\n\tCKEDITOR.dialog.add( 'image-uf', function( editor ) {\r\n\t\treturn imageDialog( editor, 'image' );\r\n\t} );\r\n\r\n\tCKEDITOR.dialog.add( 'imagebutton', function( editor ) {\r\n\t\treturn imageDialog( editor, 'imagebutton' );\r\n\t} );\r\n} )();\r\n"]}